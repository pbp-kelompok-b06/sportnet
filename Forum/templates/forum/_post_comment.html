<div class="border-l-2 border-[var(--color-main-200)] pl-4 mt-3">
  <div class="bg-[var(--color-main-50)] p-3 rounded-lg shadow-sm">

    <!-- Nama User + Timestamp -->
    <p class="font-semibold text-[var(--color-main-700)] flex items-center gap-2 flex-wrap">
      {% if post.organizer %}
        {{ post.organizer.organizer_name }}
        <span class="text-xs bg-[var(--color-main-100)] text-[var(--color-main-700)] px-2 py-0.5 rounded-full font-medium">
          Organizer
        </span>
      {% elif post.participant %}
        {{ post.participant.full_name }}
      {% else %}
        <span class="text-gray-500 italic">Unknown User</span>
      {% endif %}

      <span class="text-sm text-gray-500 ml-1">â€¢ {{ post.created_at|timesince }} ago</span>
    </p>

    <!-- Isi Pesan -->
    <p class="text-gray-800 mt-2">{{ post.content }}</p>

    <!-- Action Buttons -->
    <div class="flex items-center gap-3 text-sm mt-2">

      <!-- EDIT / DELETE hanya untuk author -->
      {% if post.participant and post.participant.user == request.user %}
        <a href="{% url 'Forum:edit_post' post.id %}" class="text-blue-600 hover:underline">Edit</a>
        <a href="{% url 'Forum:delete_post' post.id %}"
           class="text-red-600 hover:underline"
           onclick="return confirm('Are you sure you want to delete this message?');">
          Delete
        </a>

      {% elif post.organizer and post.organizer.user == request.user %}
        <a href="{% url 'Forum:edit_post' post.id %}" class="text-blue-600 hover:underline">Edit</a>
        <a href="{% url 'Forum:delete_post' post.id %}"
           class="text-red-600 hover:underline"
           onclick="return confirm('Are you sure you want to delete this message?');">
          Delete
        </a>
      {% endif %}

      <!-- Tombol Reply -->
      <a href="javascript:void(0)" onclick="toggleReply({{ post.id }})"
         class="text-[var(--color-main-500)] hover:underline">Reply</a>

    </div>

  </div>

  <!-- Form Reply -->
  <div id="reply-form-{{ post.id }}" class="ml-4 mt-2 hidden">
    <form method="POST" action="{% url 'Forum:forum_page' event.id %}">
      {% csrf_token %}
      <input type="hidden" name="parent_id" value="{{ post.id }}">
      {{ form.as_p }}
      <button type="submit" class="btn btn-gradient mt-1">Send Reply</button>
    </form>
  </div>

  <!-- Nested Replies -->
  {% for reply in post.replies.all %}
    {% include "forum/_post_comment.html" with post=reply form=form %}
  {% endfor %}
</div>

<script>
  function toggleReply(id) {
    const el = document.getElementById(`reply-form-${id}`);
    if (el) {
      el.style.display = el.style.display === "none" ? "block" : "none";
    }
  }
</script>
